<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questões para Treino</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <style>
        /* Estilos para a caixa de imagem */
        .image-box {
            width: 100%;
            max-width: 600px;
            margin: 15px auto;
            border: 2px solid var(--gray);
            border-radius: 10px;
            overflow: hidden;
            background-color: var(--white);
            box-shadow: var(--shadow);
        }
        
        .image-placeholder {
            padding: 30px;
            text-align: center;
            background-color: var(--gray-light);
            color: var(--dark);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }
        
        .image-placeholder:hover {
            background-color: var(--gray);
            color: var(--white);
        }
        
        /* Popup de imagem */
        .image-popup {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .image-popup.active {
            opacity: 1;
            visibility: visible;
        }
        
        .image-popup-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            width: auto;
            height: auto;
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }
        
        .image-popup-img {
            max-width: 100%;
            max-height: 80vh;
            display: block;
            margin: 0 auto;
        }
        
        .image-popup-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Ajustes para mobile */
        @media (max-width: 768px) {
            .image-popup-content {
                max-width: 95%;
                padding: 15px;
            }
            
            .image-popup-img {
                max-height: 70vh;
            }
            
            .image-placeholder {
                padding: 20px;
            }
        }
        
        /* Estilos para o feedback */
        .feedback-mistake-option.correct {
            background-color: var(--correct-light);
            border-left: 4px solid var(--correct);
            color: var(--correct);
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
        
        .feedback-mistake-option.incorrect {
            background-color: rgba(231, 76, 60, 0.2);
            border-left: 4px solid #c0392b;
            color: #c0392b;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Página do Quiz -->
        <div id="quizPage">
            <div class="header">
    <h1>Treino de Questões</h1>
    <div class="header-buttons">
        <button class="dark-mode-toggle" id="darkModeToggle">
            <span>Modo Escuro</span>
        </button>
        <a href="index.html" class="home-button">Página Principal</a>
    </div>
</div>


            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <div id="questionContainer">
                <!-- As questões serão inseridas aqui dinamicamente -->
            </div>

            <div class="navigation">
                <button class="nav-button" id="prevButton" disabled>Anterior</button>
                <button class="nav-button" id="nextButton">Próxima</button>
                <button class="nav-button" id="submitButton" style="display: none;">Finalizar Prova</button>
            </div>
        </div>

        <!-- Página de Resultados -->
        <div id="resultsPage">
            <div class="results-header">
                <h1>Resultados do Teste</h1>
                <div class="final-score" id="finalScore"></div>
                <div class="final-percentage" id="finalPercentage"></div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Desempenho Geral</h3>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
                <div class="stat-card">
                    <h3>Progresso</h3>
                    <div class="chart-container">
                        <canvas id="progressChart"></canvas>
                    </div>
                </div>
                <div class="stat-card">
                    <h3>Questões com Erros</h3>
                    <div class="chart-container">
                        <canvas id="mistakesChart"></canvas>
                    </div>
                </div>
                <div class="stat-card">
                    <h3>Distribuição de Dificuldade</h3>
                    <div class="chart-container">
                        <canvas id="difficultyChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="additional-stats">
                <h2>Análise Detalhada</h2>
                <div class="additional-charts">
                    <div class="stat-card">
                        <h3>Tempo por Questão</h3>
                        <div class="chart-container">
                            <canvas id="timePerQuestionChart"></canvas>
                        </div>
                    </div>
                    <div class="stat-card">
                        <h3>Evolução do Desempenho</h3>
                        <div class="chart-container">
                            <canvas id="performanceEvolutionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

           <div class="actions">
    <button class="action-button" id="restartButton">Resolver mais questões</button>
    <button class="action-button" id="reviewButton">Revisão das Questões</button>
    <a href="index.html" class="action-button home-button">Página Principal</a>
</div>
        </div>
    </div>

    <!-- Popup de Feedback -->
    <div class="feedback-popup" id="feedbackPopup">
        <div class="feedback-content">
            <button class="feedback-close" id="feedbackClose">&times;</button>
            <h2 class="feedback-title">Feedback Parcial</h2>
            <div class="feedback-stats">
                Você completou <span id="feedbackCompleted">5</span> questões.
                <span class="feedback-correct" id="feedbackCorrect">3</span> corretas e 
                <span class="feedback-incorrect" id="feedbackIncorrect">2</span> incorretas.
            </div>
            <div class="feedback-percentage" id="feedbackPercentage">60% de acerto</div>
            
            <div class="feedback-mistakes" id="feedbackMistakes">
                <!-- Erros serão inseridos aqui -->
            </div>
            
            <button class="feedback-continue" id="feedbackContinue">Continuar</button>
        </div>
    </div>

    <!-- Popup de Imagem -->
    <div class="image-popup" id="imagePopup">
        <div class="image-popup-content">
            <button class="image-popup-close" id="imagePopupClose">&times;</button>
            <img id="popupImage" class="image-popup-img" src="" alt="Imagem ampliada da questão">
        </div>
    </div>

    <!-- Visualizador de PDF -->
    <div class="pdf-viewer-popup" id="pdfViewerPopup">
        <div class="pdf-viewer-content">
            <button class="pdf-viewer-close" id="pdfViewerClose">&times;</button>
            <h2 class="pdf-viewer-title">Visualização da Questão</h2>
            <div class="pdf-container" id="pdfContainer">
                <canvas id="pdfCanvas"></canvas>
            </div>
            <button class="pdf-viewer-close-btn" id="pdfViewerCloseBtn">Fechar</button>
        </div>
    </div>

    <script>
        // Configuração do PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';

        // Variáveis globais
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let testStatistics = {
            attemptsHistory: [],
            correct: [],
            incorrect: [],
            mistakesByQuestion: {},
            attemptsCount: 0,
            startTime: null,
            questionTimes: []
        };
        const charts = {};
        let currentTestQuestions = [];
        let totalQuestions = 7;
        let questionsPerFeedback = 5;

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Carregar questões
            currentTestQuestions = sampleQuestions.slice(0, totalQuestions);
            
            // Inicializar array de respostas e tempos
            userAnswers = new Array(currentTestQuestions.length).fill(null);
            testStatistics.questionTimes = new Array(currentTestQuestions.length).fill(0);
            
            // Configurar eventos
            setupEventListeners();
            
            // Mostrar primeira questão
            showQuestion(currentQuestionIndex);
            updateProgressBar();
        });

        function setupEventListeners() {
            document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);
            document.getElementById('prevButton').addEventListener('click', showPreviousQuestion);
            document.getElementById('nextButton').addEventListener('click', showNextQuestion);
            document.getElementById('submitButton').addEventListener('click', finishTest);
            document.getElementById('restartButton').addEventListener('click', restartTest);
            document.getElementById('reviewButton').addEventListener('click', reviewQuestions);
            document.getElementById('feedbackClose').addEventListener('click', closeFeedback);
            document.getElementById('feedbackContinue').addEventListener('click', closeFeedback);
            document.getElementById('pdfViewerClose').addEventListener('click', closePdfViewer);
            document.getElementById('pdfViewerCloseBtn').addEventListener('click', closePdfViewer);
            document.getElementById('imagePopupClose').addEventListener('click', closeImagePopup);
        }

        // Funções do aplicativo
        function showQuestion(index) {
            if (index < 0 || index >= currentTestQuestions.length) return;
            
            // Registrar tempo da questão anterior
            if (testStatistics.startTime !== null && currentQuestionIndex >= 0) {
                const timeSpent = (Date.now() - testStatistics.startTime) / 1000;
                testStatistics.questionTimes[currentQuestionIndex] = timeSpent;
            }
            
            currentQuestionIndex = index;
            testStatistics.startTime = Date.now();
            
            const question = currentTestQuestions[index];
            const questionContainer = document.getElementById('questionContainer');
            
            let html = `
                <div class="question-container" id="currentQuestion">
                    <div class="question-number">Questão ${index + 1} de ${currentTestQuestions.length}</div>
                    <div class="question-text">${question.enunciado}</div>
            `;
            
            if (question.imagem) {
                html += `
                    <div class="image-box">
                        <div class="image-placeholder" onclick="showImagePopup('${question.imagem}')">
                            <span>Clique para visualizar a imagem da questão</span>
                        </div>
                    </div>
                `;
            }
            
            html += `<div class="options">`;
            
            // Adicionar alternativas
            for (const [key, value] of Object.entries(question.alternativas)) {
                const isChecked = userAnswers[index] === key ? 'checked' : '';
                html += `
                    <label class="option">
                        <input type="radio" name="answer" value="${key}" ${isChecked}>
                        <span class="option-text">${key.toUpperCase()}) ${value}</span>
                    </label>
                `;
            }
            
            html += `</div></div>`;
            
            questionContainer.innerHTML = html;
            
            // Configurar eventos das opções
            document.querySelectorAll('input[name="answer"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    userAnswers[index] = this.value;
                    saveAnswer(index, this.value);
                });
            });
            
            // Atualizar botões de navegação
            updateNavigationButtons();
            
            // Verificar se devemos mostrar feedback
            if ((index + 1) % questionsPerFeedback === 0 && index > 0) {
                showFeedback(index + 1);
            }
        }

        function showImagePopup(imageSrc) {
            // Em uma implementação real, você carregaria a imagem do PDF aqui
            // Para este exemplo, vamos usar um placeholder
            document.getElementById('popupImage').src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZWVlZWVlIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzY2NiI+UHJldmlzdWEgZGEgSW1hZ2VtPC90ZXh0Pjwvc3ZnPg==';
            document.getElementById('imagePopup').classList.add('active');
        }

        function closeImagePopup() {
            document.getElementById('imagePopup').classList.remove('active');
        }

        // ... (restante das funções permanece igual) ...

        // =============================================
        // BANCO DE QUESTÕES
        // =============================================
        const sampleQuestions = [
            // ... (questões permanecem iguais) ...
        ];
    </script>
</body>
</html>
